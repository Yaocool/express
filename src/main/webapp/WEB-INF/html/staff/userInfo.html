<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人信息 - 高校快递代取系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" href="/express/assets/css/bootstrap.css"/>
    <link rel="stylesheet" href="/express/assets/css/bootstrap-table.css"/>
    <link rel="stylesheet" href="/express/assets/css/bootstrap-datetimepicker.min.css"/>
    <link rel="stylesheet" href="/express/assets/css/express.css">


</head>
<body>
<div class="container-fluid">
    <!-- 顶栏 -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand">高校快递代取系统</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                            <div id="showUser"><span class="caret"></span></div>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="/express/logout">注销</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- 主体 -->
    <div class="row">
        <!-- 左侧菜单 -->
        <div class="col-md-2 ">
            <ul class="nav nav-pills nav-stacked" id="nav">
                <li><a href="/express/staff/home">接单大厅<span class="glyphicon glyphicon-home pull-right"/></a></li>
                <li><a href="/express/index">发布订单<span class="glyphicon glyphicon-plus pull-right"/></a></li>
                <li><a href="/express/staff/express">已接订单<span class="glyphicon glyphicon-check pull-right"/></a></li>
                <li><a href="/express/staff/myexpress">我的订单<span class="glyphicon glyphicon-user pull-right"/></a></li>
                <li><a href="/express/staff/feedback">意见反馈<span class="glyphicon glyphicon-envelope pull-right"/></a></li>
                <li><a href="/express/staff/myFeedback">我的反馈<span class="glyphicon glyphicon-paperclip pull-right"/></a></li>
                <li><a href="/express/staff/dataStatistics">数据统计<span class="glyphicon glyphicon-list-alt pull-right"/></a></li>
                <li  class="active"><a href="/express/staff/userInfo">个人信息<span class="glyphicon glyphicon-wrench pull-right"/></a></li>
                <li><a href="/express/staff/password">修改密码<sapn class="glyphicon glyphicon-pencil pull-right" /></a></li>
                <li><a href="/express/logout">退出系统<sapn class="glyphicon glyphicon-log-out pull-right" /></a></li>
            </ul>
        </div>
        <!-- 右侧数据 -->

        <div class="col-md-10">
                <form class="form-horizontal" id="updateUserInfo">
                    <div class="form-group col-md-6">
                        <label for="username" class="col-sm-3 control-label">用户名</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="username" placeholder="用户名" name="username">
                        </div>
                    </div>

                    <div class="form-group col-md-6">
                        <label for="tel" class="col-sm-3 control-label">电&nbsp;&nbsp;话</label>
                        <div class="col-sm-9">
                            <input type="text" name="tel" class="form-control" id="tel" placeholder="电话">
                        </div>
                    </div>

                    <div class="form-group col-md-6">
                        <label class="col-sm-3 control-label">性&nbsp;&nbsp;别</label>
                        <div class="col-sm-6 sex">
                            <label class="radio-inline">
                                <input type="radio" name="sex" id="inlineRadio1" value="male"> 男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="sex" id="inlineRadio2" value="female"> 女
                            </label>
                        </div>
                    </div>


                    <div class="form-group col-md-6">
                        <label for="birthday" class="col-sm-3 date control-label">生&nbsp;&nbsp;日</label>
                        <div class="input-group date col-sm-9" id="datetimepicker3">
                            <input type='text' name="birthday" class="form-control" id = "birthday"/>
                            <span class="input-group-addon">
                              <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>

                    <div class="form-inline col-md-4">
                        <label for="email" class="col-sm-6 text-center">邮&nbsp;&nbsp;箱&nbsp;&nbsp;</label>
                        <div class="col-sm-6">
                            <p class="form-group text-left" id="email"></p>
                        </div>
                    </div>

                    <div class="form-inline col-md-4">
                        <label for="status" class="col-sm-5 text-left">用户状态&nbsp;&nbsp;</label>
                        <div class="col-sm-7">
                            <p class="form-group text-left" id="status"></p>
                        </div>
                    </div>
                    <div class="form-inline col-md-4">
                        <label for="createTime" class="col-sm-4 text-left">创建时间&nbsp;&nbsp;</label>
                        <div class="col-sm-8">
                            <p class="form-group text-left" id="createTime"></p>
                        </div>
                    </div>
                    <div class="form-group col-md-12"></div>
                    <div class="form-group col-md-9">
                        <label for="address" class="col-sm-2 control-label">地&nbsp;&nbsp;址</label>
                        <div class="col-sm-10">
                            <textarea name="address" class="form-control" rows="3" id="address"></textarea>
                        </div>
                    </div>
            <div class="form-group col-md-12">
                <div align="center">
                    <button type="submit" class="btn btn-warning">修&nbsp;&nbsp;改</button>
                </div>
            </div>
            </form>
        </div>
    </div>
</div>
<script src="/express/assets/js/jquery3.3.1.min.js"></script>
<script src="/express/assets/js/jquery.validate.min.js"></script>
<script src="/express/assets/js/bootstrap.min.js"></script>
<script src="/express/assets/js/bootstrap-table.min.js"></script>
<script src="/express/assets/js/bootstrap-table-zh-CN.min.js"></script>
<script src="/express/assets/layer/layer.js"></script>
<script src="/express/assets/js/http.js"></script>
<script src="/express/assets/js/bootstrap-datetimepicker.js" ></script>
<script src="/express/assets/js/bootstrap-datetimepicker.zh-CN.js" ></script>
<script src="/express/assets/js/bootstrap-datetimepicker.fr.js" ></script>
<script type="text/javascript">
    // 获取登录名
    sendJson("get", "/express/username", {}, true, function (res) {
        if (res.status) {
            $("#showUser").text(res.data);
        }
    }, function () {
        layer.msg("未知错误",{icon:2});
    });

    // 获取当前用户信息
    sendJson("get", "/express/staff/userInfo/getUserInfo", {}, true, function (res) {
        if (res.status) {
            $("#username").attr("value", res.data.user.username);
            $("#tel").attr("value", res.data.user.tel);
            if (res.data.user.sex == "male") {
                $("#inlineRadio1").attr("checked", "checked");
            }
            if (res.data.user.sex == "female") {
                $("#inlineRadio2").attr("checked", "checked");
            }
            $("#birthday").attr("value", res.data.user.birthday);
            $("#email").text(res.data.user.email);
            $("#status").text(res.data.status);
            $("#createTime").text(res.data.user.createDate);
            $("#address").text(res.data.user.address);
        }
    }, function () {
        layer.msg("未知错误",{icon:2});
    });

    $('#datetimepicker3').datetimepicker({
        format: 'yyyy-mm-dd',
        language:  'zh-CN',
        weekStart: 1,
        todayBtn:  1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });

    // 修改信息验证
    $().ready(function() {
        $.validator.addMethod("isPhone", function(value, element) {
            var length = value.length;
            var mobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/;
            return this.optional(element) || (length == 11 && mobile.test(value));
        }, "请填写正确的手机号码");

        $("#updateUserInfo").validate({
            rules: {
                username: {
                    required:true,
                    rangelength:[2,10]
                },
                tel:{
                    required:true,
                    isPhone:true
                },
                address:{
                    required:true,
                    rangelength:[2,200]
                },

            },
            messages: {
                username: {
                    required: "用户名不能为空！",
                    rangelength: "用户名必须在2-10字符之间!"
                },
                tel: {
                    required: "电话号码不能为空",
                    isPhone: "请填写正确的手机号码",
                },
                address: {
                    required: "地址不能为空！",
                    rangelength: "地址必须在2-200字符之间！",
                }
            },
            submitHandler: function () {
                var username = $("#username").val();
                var tel = $("#tel").val();
                var sex = $('input:radio:checked').val();
                var birthday = $("#birthday").val();
                var address = $("#address").val();
                sendJson("post", "/express/staff/userInfo/updateUserInfo", {"username":username,"tel":tel,"sex":sex,"birthday":birthday,"address":address}, false, function (res) {
                    if (!res.status) {
                        layer.msg(res.info,{icon:2});
                    } else {
                        layer.msg("修改成功！",{icon:1});
                        location.reload(true);
                    }
                }, function () {
                    layer.msg("修改失败！",{icon:2});
                });
            }
        });
    });
</script>
</body>
</html>